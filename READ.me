# ğŸš¢ Port de Plaisance Russell - API de Gestion

Application web de gestion des rÃ©servations de catways pour le Port de Plaisance Russell.

## ğŸŒ DÃ©ploiement

**Application dÃ©ployÃ©e :** https://port-russell-api.onrender.com

**Documentation API :** https://port-russell-api.onrender.com/api-docs

### ğŸ‘¤ Identifiants de test
- **Email :** admin@port-russell.fr
- **Mot de passe :** admin123

---

## ğŸ“‹ Description

Cette application permet Ã  la capitainerie du port de gÃ©rer efficacement :
- Les catways (appontements)
- Les rÃ©servations de bateaux
- Les utilisateurs du systÃ¨me

L'application propose :
- Une API REST complÃ¨te et documentÃ©e
- Une interface web intuitive pour la gestion
- Un systÃ¨me d'authentification sÃ©curisÃ©

## ğŸ› ï¸ Technologies utilisÃ©es

- **Backend**: Node.js, Express.js
- **Base de donnÃ©es**: MongoDB avec Mongoose
- **Authentification**: JWT + Express Session
- **Frontend**: EJS, CSS3, JavaScript vanilla
- **SÃ©curitÃ©**: bcryptjs pour le hashage des mots de passe
- **DÃ©ploiement**: Render.com

## ğŸ“¦ Installation locale

### PrÃ©requis
- Node.js (v16 ou supÃ©rieur)
- MongoDB (local ou MongoDB Atlas)
- Git

### Ã‰tapes d'installation

1. **Cloner le repository**
```bash
git clone https://github.com/ClementLoire/port-russell-api.git
cd port-russell-api
```

2. **Installer les dÃ©pendances**
```bash
npm install
```

3. **Configuration de l'environnement**

CrÃ©ez un fichier `.env` Ã  la racine du projet :
```env
PORT=3000
MONGODB_URI=mongodb://localhost:27017/port-russell
JWT_SECRET=votre_secret_jwt_changez_moi
SESSION_SECRET=votre_secret_session_changez_moi
NODE_ENV=development
```

**Pour MongoDB Atlas** :
```env
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/port-russell
```

4. **Initialiser la base de donnÃ©es**
```bash
npm run seed
```

Cette commande va :
- CrÃ©er un utilisateur admin (email: `admin@port-russell.fr`, mot de passe: `admin123`)
- Importer les catways depuis `data/catways.json`
- Importer les rÃ©servations depuis `data/reservations.json`

5. **DÃ©marrer le serveur**

En mode dÃ©veloppement (avec rechargement automatique) :
```bash
npm run dev
```

En mode production :
```bash
npm start
```

6. **AccÃ©der Ã  l'application**
- Interface web : http://localhost:3000
- Documentation API : http://localhost:3000/api-docs

## ğŸ” Authentification

### Pour l'interface web
- Connectez-vous sur http://localhost:3000/login
- Utilisez les identifiants admin crÃ©Ã©s lors du seed

### Pour l'API
1. Obtenez un token JWT :
```bash
POST /api/login
Content-Type: application/json

{
  "email": "admin@port-russell.fr",
  "password": "admin123"
}
```

2. Utilisez le token dans vos requÃªtes :
```bash
Authorization: Bearer <votre_token>
```

## ğŸ“š Endpoints de l'API

### Authentication
- `POST /api/login` - Connexion (retourne un token JWT)

### Catways
- `GET /api/catways` - Liste tous les catways
- `GET /api/catways/:id` - DÃ©tails d'un catway
- `POST /api/catways` - CrÃ©er un catway
- `PUT /api/catways/:id` - Modifier l'Ã©tat d'un catway
- `DELETE /api/catways/:id` - Supprimer un catway

### RÃ©servations
- `GET /api/reservations` - Liste toutes les rÃ©servations
- `GET /api/catways/:id/reservations` - RÃ©servations d'un catway
- `GET /api/catways/:id/reservations/:idReservation` - DÃ©tails d'une rÃ©servation
- `POST /api/catways/:id/reservations` - CrÃ©er une rÃ©servation
- `PUT /api/catways/:id/reservations/:idReservation` - Modifier une rÃ©servation
- `DELETE /api/catways/:id/reservations/:idReservation` - Supprimer une rÃ©servation

### Utilisateurs
- `GET /api/users` - Liste tous les utilisateurs
- `GET /api/users/:email` - DÃ©tails d'un utilisateur
- `POST /api/users` - CrÃ©er un utilisateur
- `PUT /api/users/:email` - Modifier un utilisateur
- `DELETE /api/users/:email` - Supprimer un utilisateur

## ğŸ“– Exemples d'utilisation de l'API

### CrÃ©er une rÃ©servation
```bash
POST /api/catways/1/reservations
Authorization: Bearer <token>
Content-Type: application/json

{
  "clientName": "Jean Dupont",
  "boatName": "L'Aventurier",
  "startDate": "2024-06-01",
  "endDate": "2024-06-15"
}
```

### Modifier l'Ã©tat d'un catway
```bash
PUT /api/catways/1
Authorization: Bearer <token>
Content-Type: application/json

{
  "catwayState": "En maintenance - RÃ©paration prÃ©vue le 15/06"
}
```

## ğŸ—‚ï¸ Structure du projet

```
port-russell-api/
â”œâ”€â”€ config/              # Configuration (base de donnÃ©es)
â”œâ”€â”€ controllers/         # Logique mÃ©tier
â”œâ”€â”€ middleware/          # Middleware (authentification)
â”œâ”€â”€ models/             # ModÃ¨les Mongoose
â”œâ”€â”€ routes/             # Routes de l'API
â”œâ”€â”€ views/              # Templates EJS
â”œâ”€â”€ public/             # Fichiers statiques (CSS, JS)
â”œâ”€â”€ data/               # DonnÃ©es d'initialisation
â”œâ”€â”€ scripts/            # Scripts utilitaires (seed)
â”œâ”€â”€ .env                # Variables d'environnement
â”œâ”€â”€ server.js           # Point d'entrÃ©e de l'application
â””â”€â”€ package.json        # DÃ©pendances et scripts
```

## âœ¨ FonctionnalitÃ©s

### Interface Web
- âœ… Page d'accueil avec prÃ©sentation
- âœ… SystÃ¨me de connexion/dÃ©connexion
- âœ… Dashboard avec statistiques
- âœ… Gestion complÃ¨te des catways (CRUD)
- âœ… Gestion des rÃ©servations (CRUD)
- âœ… Gestion des utilisateurs (CRUD)
- âœ… DÃ©tection automatique des conflits de rÃ©servations
- âœ… Affichage du statut des rÃ©servations (en cours, terminÃ©e, Ã  venir)

### API REST
- âœ… Authentification JWT sÃ©curisÃ©e
- âœ… Routes RESTful pour toutes les ressources
- âœ… Validation des donnÃ©es
- âœ… Gestion des erreurs
- âœ… Documentation complÃ¨te

### SÃ©curitÃ©
- âœ… Mots de passe hashÃ©s avec bcrypt
- âœ… Protection JWT pour l'API
- âœ… Sessions sÃ©curisÃ©es pour le web
- âœ… Validation des entrÃ©es utilisateur
- âœ… Protection contre les conflits de rÃ©servations

## ğŸš€ DÃ©ploiement sur Render

### Variables d'environnement Ã  configurer

```env
PORT=3000
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/port-russell
JWT_SECRET=votre_secret_securise_production
SESSION_SECRET=votre_secret_securise_production
NODE_ENV=production
```

### Configuration Render
- **Build Command:** `npm install`
- **Start Command:** `npm start`
- **Region:** Frankfurt (ou le plus proche)

## ğŸ“Š Collections MongoDB

- **users** : Utilisateurs de l'application
- **catways** : 24 catways du port
- **reservations** : RÃ©servations de bateaux

## ğŸ”’ SÃ©curitÃ©

- Les mots de passe sont hashÃ©s avec bcrypt (10 rounds)
- Les routes API sont protÃ©gÃ©es par JWT
- Les sessions web utilisent des cookies sÃ©curisÃ©s (en production)
- Validation des donnÃ©es avec express-validator
- Protection contre les injections MongoDB

## ğŸ“ Notes importantes

- Changez les secrets dans le fichier `.env` avant le dÃ©ploiement
- CrÃ©ez des utilisateurs avec des mots de passe forts en production
- Configurez HTTPS en production
- Les cookies sÃ©curisÃ©s sont activÃ©s automatiquement en production (NODE_ENV=production)

## ğŸ¤ Contribution

Pour contribuer :
1. Fork le projet
2. CrÃ©ez une branche (`git checkout -b feature/amelioration`)
3. Committez vos changements (`git commit -m 'Ajout fonctionnalitÃ©'`)
4. Push vers la branche (`git push origin feature/amelioration`)
5. Ouvrez une Pull Request

## ğŸ“„ Licence

ISC

## ğŸ‘¥ Auteur

Projet rÃ©alisÃ© dans le cadre de la formation dÃ©veloppeur web - Port de Plaisance Russell

## ğŸ“ Support

Pour toute question ou problÃ¨me :
- Issues GitHub : [lien vers les issues]
- Email : support@port-russell.fr